# Claude harness - 開発フロー完全ガイド

**VibeCoder向け**: 1人でクライアントプロジェクトを遂行するための実践的な開発フロー

---

## 📋 目次

1. [新規プロジェクトの開発フロー](#新規プロジェクトの開発フロー)
2. [既存プロジェクトへの適用](#既存プロジェクトへの適用)
3. [フェーズ別詳細ガイド](#フェーズ別詳細ガイド)
4. [実践例](#実践例)

---

## 🆕 新規プロジェクトの開発フロー

### 全体の流れ（5フェーズ）

```
📝 フェーズ1: 計画（1-2時間）
   ↓
🎨 フェーズ2: フロントエンド実装（プロジェクトによる）
   ↓
⚙️  フェーズ3: バックエンド実装（プロジェクトによる）
   ↓
🚀 フェーズ4: デプロイ設定（30分-1時間）
   ↓
✅ フェーズ5: 品質保証と納品（1-2時間）
```

---

### フェーズ1: 計画 📝

#### 1-1. プロジェクト開始

```bash
# 新規プロジェクトディレクトリを作成
mkdir my-client-project
cd my-client-project

# Gitリポジトリを初期化
git init

# Claude Codeを起動
# プラグイン導入済みなら:
claude
#
# （開発中などでプラグインディレクトリを指定して起動したい場合）
claude --plugin-dir /path/to/claude-code-harness
```

#### 1-2. クライアント要件を整理

Claude Codeで以下を実行：

```
/plan
```

**Claude Codeが質問してくること：**
1. クライアントは何を作りたいか？
2. 主要な機能は？（3-5個）
3. 納期と予算は？

**あなたがすること：**
- クライアントからのメールや打ち合わせメモを見ながら回答
- わからないことは「わからない」と正直に答える

**成果物：**
- `docs/proposal.md` - クライアント向け提案書
- `docs/technical-spec.md` - 技術仕様書
- `Plans.md` - 実装計画

#### 1-3. クライアントに提案書を送付

```bash
# 提案書を確認
cat docs/proposal.md

# クライアントにメールで送付
# 承認を待つ
```

---

### フェーズ2: フロントエンド実装 🎨

#### 2-1. UIコンポーネントの実装

```
/component
```

**Claude Codeが質問してくること：**
- どのコンポーネントが必要か？
- デザインはあるか？（Figma、スクリーンショットなど）

**あなたがすること：**
- 必要なコンポーネントをリストアップ
  - 例: ヘッダー、フッター、カード、フォーム、ボタン
- デザインがあれば共有

**成果物：**
- `components/` - 再利用可能なUIコンポーネント
- レスポンシブデザイン対応
- アクセシビリティ対応

#### 2-2. ページ・機能の実装

```
/work
```

**Claude Codeが質問してくること：**
- どの機能を実装するか？
- `Plans.md`のどのタスクか？

**あなたがすること：**
- `Plans.md`を確認
- 1つの機能を指定（例: ユーザー登録画面）

**成果物：**
- 指定した機能の実装
- 必要なページ、コンポーネント、ロジック

**ポイント：**
- **1つずつ実装する**（一度に全部やらない）
- 実装後は動作確認

---

### フェーズ3: バックエンド実装 ⚙️

#### 3-1. 認証機能の実装

```
/auth
```

**Claude Codeが質問してくること：**
- どの認証サービスを使うか？
  - Clerk（推奨・簡単）
  - Supabase Auth（データベース統合）

**あなたがすること：**
- 選択肢から選ぶ
- APIキーを用意（必要に応じて）

**成果物：**
- ログイン・ログアウト機能
- ユーザー登録機能
- 認証状態の管理

#### 3-2. データベース操作（CRUD）の実装

```
/crud tasks
```
（`tasks`は例。実際のエンティティ名を指定）

**Claude Codeが質問してくること：**
- どんなデータを扱うか？
  - 例: タスク、ユーザー、商品、予約
- どんな項目が必要か？
  - 例: タイトル、説明、期限、担当者

**あなたがすること：**
- エンティティ名を指定
- 必要な項目をリストアップ

**成果物：**
- データベーステーブル
- CRUD API（作成・読取・更新・削除）
- バリデーション
- 認可チェック

#### 3-3. 決済機能の実装（必要な場合）

```
/payments
```

**Claude Codeが質問してくること：**
- どの決済サービスを使うか？（Stripe推奨）
- 料金プランは？

**あなたがすること：**
- Stripeアカウントを作成
- 料金プランを決定

**成果物：**
- Stripe統合
- サブスクリプション管理
- 決済フロー

---

### フェーズ4: デプロイ設定 🚀

#### 4-1. CI/CD設定

```
/ci-setup
```

**成果物：**
- `.github/workflows/` - GitHub Actions設定
- 自動テスト
- 自動ビルド

#### 4-2. デプロイ設定

```
/deploy-setup
```

**Claude Codeが質問してくること：**
- どこにデプロイするか？
  - Vercel（Next.js推奨）
  - Netlify（静的サイト）

**あなたがすること：**
- デプロイ先を選択
- アカウントを用意

**成果物：**
- 自動デプロイ設定
- 環境変数設定ガイド
- デプロイURL

---

### フェーズ5: 品質保証と納品 ✅

#### 5-1. コードレビュー

```
/harness-review
```

**Claude Codeがチェックすること：**
- セキュリティ脆弱性
- パフォーマンス問題
- コード品質
- アクセシビリティ

**成果物：**
- レビューレポート
- 改善提案リスト

#### 5-2. 自動修正

```
/auto-fix
```

**成果物：**
- レビューで指摘された問題の自動修正

#### 5-3. 納品前検証

```
/validate
```

**Claude Codeがチェックすること：**
- 全機能が動作するか
- パフォーマンスは十分か
- セキュリティ対策は万全か
- ドキュメントは揃っているか

**成果物：**
- 検証レポート
- 納品チェックリスト

#### 5-4. クライアントに納品

```bash
# 最終コミット
git add .
git commit -m "feat: プロジェクト完成"
git push

# クライアントに以下を送付：
# 1. デプロイURL
# 2. 管理画面のログイン情報
# 3. README.md（使い方）
# 4. docs/proposal.md（提案書）
```

---

## 🔄 既存プロジェクトへの適用

### 前提条件

- 既存のプロジェクトがある
- Gitで管理されている（推奨）

---

### ステップ1: 事前準備

```bash
# プロジェクトディレクトリに移動
cd /path/to/existing-project

# 未コミットの変更を確認
git status

# ⚠️ 重要: 変更がある場合は必ずコミット
git add .
git commit -m "chore: ハーネス適用前のコミット"
```

**なぜコミットが必要？**
- ハーネス適用前の状態を保存
- 問題があれば元に戻せる
- 変更履歴が明確になる

---

### ステップ2: セットアップスクリプトの実行

```bash
# claude-code-harnessのパス
HARNESS_PATH=/path/to/claude-code-harness

# セットアップスクリプトを実行
$HARNESS_PATH/scripts/setup-existing-project.sh
```

**スクリプトが自動的に行うこと：**

1. ✅ **前提条件チェック**
   - プロジェクトディレクトリの確認
   - Gitリポジトリの確認
   - 未コミット変更の警告

2. 📄 **既存ドキュメントの探索**
   - README.md
   - SPEC.md / 仕様書.md
   - Plans.md / 計画.md
   - docs/以下のドキュメント
   
   **見つかったドキュメント：**
   ```
   ✓ 発見: README.md
   ✓ 発見: docs/spec.md
   ✓ 発見: Plans.md
   
   3 個のドキュメントを発見しました
   ```

3. 🔍 **プロジェクト分析**
   - 技術スタックの検出
     - Node.js / TypeScript
     - React / Next.js / Vue
     - データベース
     - 認証サービス

4. ⚙️ **設定ファイルの作成**
   - `.claude-code-harness/config.json` - ハーネス設定
   - `.claude-code-harness/existing-docs-summary.md` - 既存ドキュメントのサマリー

5. 📋 **Project Rulesの作成**
   - `.claude/rules/harness.md` - Claude Code向けルール
   - 既存資産を尊重するルール

---

### ステップ3: 既存ドキュメントの確認

```bash
# 既存ドキュメントのサマリーを確認
cat .claude-code-harness/existing-docs-summary.md
```

**内容例：**
```markdown
# 既存ドキュメント一覧

このプロジェクトには以下の既存ドキュメントがあります：

## README.md
（最初の20行を表示）

## docs/spec.md
（最初の20行を表示）

## Plans.md
（最初の20行を表示）
```

**なぜ重要？**
- 既存の仕様を理解してから作業開始
- 矛盾を避ける
- 今までの作業を無駄にしない

---

### ステップ4: Claude Codeで開く

```bash
# プラグイン導入済みなら:
claude
#
# （開発中などでプラグインディレクトリを指定して起動したい場合）
claude --plugin-dir /path/to/claude-code-harness
```

---

### ステップ5: 既存仕様を確認してから計画更新

```
/plan
```

**Claude Codeが自動的に行うこと：**
1. `.claude-code-harness/existing-docs-summary.md`を読む
2. 既存の仕様書を理解
3. 既存の計画を尊重しながら更新

**あなたがすること：**
- 既存の仕様と矛盾がないか確認
- 追加したい機能があれば指示

**成果物：**
- 既存の`Plans.md`を更新（上書きではなく追記）
- 既存の仕様を考慮した計画

---

### ステップ6: 小さな機能から実装開始

```
/work
```

**ポイント：**
- **小さく始める**
  - 例: 「ログイン画面のデザイン改善」
  - 例: 「新しいAPIエンドポイント1つ追加」
- **既存コードを壊さない**
  - 既存のスタイルに合わせる
  - 既存の機能に影響を与えない
- **こまめに確認**
  - 実装後すぐに動作確認
  - 問題があればすぐに修正

---

### 既存プロジェクトでの注意点

#### ✅ DO（推奨）

1. **既存ドキュメントを必ず読む**
   ```bash
   cat .claude-code-harness/existing-docs-summary.md
   ```

2. **小さく始める**
   - 1つの機能から
   - 動作確認してから次へ

3. **こまめにコミット**
   ```bash
   git add .
   git commit -m "feat: ログイン画面改善"
   ```

4. **既存のスタイルを尊重**
   - コーディング規約
   - ディレクトリ構造
   - 命名規則

#### ❌ DON'T（避けるべき）

1. **いきなり全部書き換える**
   - 既存コードを一度に変更しない
   - 段階的に改善

2. **既存ドキュメントを無視**
   - 必ず既存の仕様を確認
   - 矛盾があれば質問

3. **未コミットで作業開始**
   - 必ず事前にコミット
   - 問題があれば戻せるように

---

## 📚 フェーズ別詳細ガイド

### 計画フェーズのコツ

#### 新規プロジェクト
```
/plan

（Claude Codeの質問に答える）
Q: クライアントは何を作りたいと言っていますか？
A: 予約管理システム

Q: 主要な機能は？
A: 
- 予約の作成・編集・削除
- カレンダー表示
- メール通知
- 管理者ダッシュボード

Q: 納期は？
A: 2週間後
```

#### 既存プロジェクト
```
/plan

（Claude Codeが既存ドキュメントを読んでから質問）
Q: 既存の仕様書を確認しました。追加したい機能はありますか？
A: カレンダー表示機能を追加したい

Q: 既存の予約機能との連携は？
A: 既存のAPIをそのまま使う
```

---

### 実装フェーズのコツ

#### 効率的な実装順序

1. **認証から始める**（ユーザー機能がある場合）
   ```
   /auth
   ```

2. **データモデルを定義**
   ```
   /crud users
   /crud bookings
   ```

3. **UIを実装**
   ```
   /component
   /work
   ```

4. **追加機能**
   ```
   /payments  （決済が必要な場合）
   /analytics （アクセス解析）
   /feedback  （フィードバック機能）
   ```

---

### レビューフェーズのコツ

#### レビューのタイミング

**推奨：** 機能ごとにレビュー
```
/work（機能A実装）
↓
/harness-review（機能Aレビュー）
↓
/auto-fix（問題修正）
↓
/work（機能B実装）
↓
/harness-review（機能Bレビュー）
```

**非推奨：** 全実装後に1回だけ
```
/work（全機能実装）
↓
/harness-review（大量の問題発見）
↓
修正が大変...
```

---

## 💡 実践例

### 例1: 新規プロジェクト「タスク管理アプリ」

```bash
# 1. プロジェクト作成
mkdir task-manager
cd task-manager
git init

# 2. Claude Code起動
# プラグイン導入済みなら:
claude
#
# （開発中などでプラグインディレクトリを指定して起動したい場合）
claude --plugin-dir /path/to/claude-code-harness

# 3. 計画
/plan
> タスク管理アプリ
> - タスクのCRUD
> - カテゴリ分け
> - 期限管理
> - 完了/未完了の切り替え

# 4. 認証実装
/auth
> Clerk

# 5. データモデル
/crud tasks
> タイトル、説明、期限、カテゴリ、完了フラグ

# 6. UI実装
/component
> タスクカード、タスクリスト、タスクフォーム

/work
> タスク一覧画面を実装

# 7. レビュー
/harness-review
/auto-fix

# 8. デプロイ
/ci-setup
/deploy-setup
> Vercel

# 9. 最終検証
/validate
```

---

### 例2: 既存プロジェクト「ECサイト」への機能追加

```bash
# 1. 事前準備
cd ~/projects/my-ec-site
git status
git add .
git commit -m "chore: ハーネス適用前"

# 2. セットアップ
~/claude-code-harness/scripts/setup-existing-project.sh

# 出力:
# ✓ 発見: README.md
# ✓ 発見: docs/spec.md
# ✓ 発見: Plans.md
# 3 個のドキュメントを発見しました

# 3. 既存ドキュメント確認
cat .claude-code-harness/existing-docs-summary.md

# 4. Claude Code起動
# プラグイン導入済みなら:
claude
#
# （開発中などでプラグインディレクトリを指定して起動したい場合）
claude --plugin-dir /path/to/claude-code-harness

# 5. 既存仕様を確認してから計画更新
/plan
> 既存の商品管理機能に、レビュー機能を追加したい

# 6. 小さく実装
/work
> 商品詳細ページにレビュー表示エリアを追加

# 7. レビュー
/harness-review

# 8. データモデル追加
/crud reviews
> 商品ID、ユーザーID、評価、コメント

# 9. 動作確認
（ブラウザで確認）

# 10. コミット
git add .
git commit -m "feat: レビュー機能追加"
```

---

## 🎯 まとめ

### 新規プロジェクト
1. `/plan-with-agent` で計画
2. `/auth` で認証
3. `/crud` でデータ
4. `/work` で実装
5. `/harness-review` でチェック
6. `/deploy-setup` でデプロイ
7. `/validate` で検証

### 既存プロジェクト
1. **コミット必須**
2. `setup-existing-project.sh` 実行
3. **既存ドキュメント確認**
4. `/plan-with-agent` で計画更新（既存を尊重）
5. **小さく実装**
6. **こまめに確認**

### 成功のポイント
- ✅ 小さく分けて実装
- ✅ こまめにレビュー
- ✅ 既存資産を尊重
- ✅ ドキュメントを残す
- ✅ バージョン管理を活用

---

**バージョン**: 2.0.0  
**最終更新**: 2025年12月12日
