---
name: codex-mcp-setup
description: "Codex CLI ã®æ¤œå‡ºãƒ»MCP ç™»éŒ²ãƒ»èªè¨¼ç¢ºèªã‚’è¡Œã†ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †"
allowed-tools: ["Bash", "Read", "Write", "Edit"]
---

# Codex MCP ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

OpenAI Codex CLI ã‚’ Claude Code ã® MCP ã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦ç™»éŒ²ã™ã‚‹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã€‚

---

## ğŸ¯ ã“ã®ã‚¹ã‚­ãƒ«ã§ã‚„ã‚‹ã“ã¨

1. Codex CLI ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
2. Codex èªè¨¼çŠ¶æ…‹ã®ç¢ºèª
3. MCP ã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦ã®ç™»éŒ²
4. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°
5. å‹•ä½œç¢ºèª

---

## å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

### Step 1: Codex CLI ã®ç¢ºèª

```bash
# Codex CLI ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
which codex
```

**çµæœåˆ¤å®š**:

| çµæœ | æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|------|---------------|
| ãƒ‘ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ | Step 2 ã¸ |
| `not found` | ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¡ˆå†…ã‚’è¡¨ç¤º |

**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¡ˆå†…ï¼ˆæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ï¼‰**:

```markdown
âš ï¸ Codex CLI ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•:

1. **Homebrewï¼ˆmacOSï¼‰**:
   ```bash
   brew install openai-codex
   ```

2. **npmï¼ˆã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ï¼‰**:
   ```bash
   npm install -g @openai/codex-cli
   ```

3. **å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
   https://developers.openai.com/codex/cli/installation

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€å†åº¦ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
```

---

### Step 2: èªè¨¼çŠ¶æ…‹ã®ç¢ºèª

```bash
# ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ç¢ºèª
codex login status
```

**çµæœåˆ¤å®š**:

| çµ‚äº†ã‚³ãƒ¼ãƒ‰ | æ„å‘³ | æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|-----------|------|---------------|
| 0 | ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ | Step 3 ã¸ |
| é0 | æœªãƒ­ã‚°ã‚¤ãƒ³ | èªè¨¼æ¡ˆå†…ã‚’è¡¨ç¤º |

**èªè¨¼æ¡ˆå†…ï¼ˆæœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ï¼‰**:

```markdown
ğŸ” Codex ã«ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™

ãƒ­ã‚°ã‚¤ãƒ³æ–¹æ³•:

1. **OAuthï¼ˆæ¨å¥¨ï¼‰**:
   ```bash
   codex login
   ```
   ãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ãã€OpenAI ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§èªè¨¼ã—ã¾ã™ã€‚

2. **API ã‚­ãƒ¼**:
   ```bash
   echo $OPENAI_API_KEY | codex login --with-api-key
   ```
   ç’°å¢ƒå¤‰æ•°ã«è¨­å®šæ¸ˆã¿ã® API ã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€å†åº¦ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
```

---

### Step 3: MCP ã‚µãƒ¼ãƒãƒ¼ç™»éŒ²

```bash
# Codex ã‚’ MCP ã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦ç™»éŒ²
claude mcp add --scope user codex -- codex mcp-server
```

**æˆåŠŸæ™‚ã®å‡ºåŠ›ä¾‹**:

```
Added MCP server: codex
Scope: user
Command: codex mcp-server
```

**ã‚¨ãƒ©ãƒ¼æ™‚ã®å¯¾å¿œ**:

| ã‚¨ãƒ©ãƒ¼ | åŸå›  | å¯¾å¿œ |
|-------|------|------|
| `Already exists` | æ—¢ã«ç™»éŒ²æ¸ˆã¿ | Step 4 ã¸ï¼ˆã‚¹ã‚­ãƒƒãƒ—å¯ï¼‰ |
| `Command not found` | claude CLI ãŒãªã„ | Claude Code ã‚’æœ€æ–°ç‰ˆã«æ›´æ–° |
| `Permission denied` | æ¨©é™ä¸è¶³ | `--scope project` ã‚’è©¦ã™ |

---

### Step 4: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°

`.claude-code-harness.config.yaml` ã« Codex è¨­å®šã‚’è¿½åŠ :

```yaml
# è¿½åŠ ã™ã‚‹è¨­å®š
review:
  codex:
    enabled: true
    auto: false
    prompt: "æ—¥æœ¬èªã§ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡Œã„ã€å•é¡Œç‚¹ã¨æ”¹å–„ææ¡ˆã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„"
```

**è¨­å®šé …ç›®ã®èª¬æ˜**:

| é …ç›® | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|-----|-----|-----------|------|
| `enabled` | boolean | `false` | Codex çµ±åˆã‚’æœ‰åŠ¹åŒ– |
| `auto` | boolean | `false` | `/harness-review` æ™‚ã«è‡ªå‹•ã§ Codex ã‚’å‘¼ã³å‡ºã™ã‹ |
| `prompt` | string | (ä¸Šè¨˜) | Codex ã¸é€ä¿¡ã™ã‚‹ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ |

---

### Step 5: å‹•ä½œç¢ºèª

```bash
# MCP ã‚µãƒ¼ãƒãƒ¼ä¸€è¦§ã‚’ç¢ºèª
claude mcp list
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```
codex (user)
  Command: codex mcp-server
  Status: Ready
```

**ç°¡æ˜“ãƒ†ã‚¹ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰**:

```bash
# Codex MCP ãŒå¿œç­”ã™ã‚‹ã‹ç¢ºèª
codex exec --json "Hello, this is a test" 2>/dev/null | head -1
```

---

## å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†æ™‚ã«è¡¨ç¤º:

```markdown
âœ… Codex MCP ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†

**è¨­å®šå†…å®¹**:
- MCP ã‚µãƒ¼ãƒãƒ¼: codex (user scope)
- è‡ªå‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼: ç„¡åŠ¹ï¼ˆæ¯å›ç¢ºèªï¼‰
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨€èª: æ—¥æœ¬èª

**ä½¿ã„æ–¹**:
- `/harness-review` å®Ÿè¡Œæ™‚ã«ã€ŒCodex ã«ã‚‚ãƒ¬ãƒ“ãƒ¥ãƒ¼ã•ã›ã¾ã™ã‹ï¼Ÿã€ã¨ç¢ºèª
- `codex.auto: true` ã§è‡ªå‹•å®Ÿè¡Œã«å¤‰æ›´å¯èƒ½

**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
- `codex.enabled: true` ã‚’è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ç¢ºèª
- `/harness-review` ã§ã‚»ã‚«ãƒ³ãƒ‰ã‚ªãƒ”ãƒ‹ã‚ªãƒ³ã‚’è©¦ã™
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ: `claude mcp add` ãŒå¤±æ•—ã™ã‚‹

**åŸå› **: Claude Code ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„

**è§£æ±ºç­–**:
```bash
# Claude Code ã‚’æ›´æ–°
claude update

# å†è©¦è¡Œ
claude mcp add --scope user codex -- codex mcp-server
```

### å•é¡Œ: Codex MCP ãŒå¿œç­”ã—ãªã„

**åŸå› **: Codex CLI ã®å•é¡Œ

**è§£æ±ºç­–**:
```bash
# Codex å˜ä½“ã§å‹•ä½œç¢ºèª
codex exec "Hello" --output-last-message /tmp/test.txt
cat /tmp/test.txt
```

### å•é¡Œ: API ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹

**åŸå› **: OpenAI ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆä¸è¶³ã¾ãŸã¯ API åˆ¶é™

**è§£æ±ºç­–**:
1. OpenAI ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆç¢ºèª
2. API ä½¿ç”¨é‡åˆ¶é™ã‚’ç¢ºèª
3. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å ´åˆã¯æ™‚é–“ã‚’ç½®ã„ã¦å†è©¦è¡Œ

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Codex CLI Reference](https://developers.openai.com/codex/cli/reference/)
- [Claude Code MCP å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.anthropic.com/claude-code/mcp)
- [codex-review-integration.md](./codex-review-integration.md) - ãƒ¬ãƒ“ãƒ¥ãƒ¼çµ±åˆæ‰‹é †
