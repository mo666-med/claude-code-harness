# AGENTS.md - 開発フロー概要

> **プロジェクト**: {{PROJECT_NAME}}
> **作成日**: {{DATE}}
> **言語**: {{LANGUAGE}}

---

## 0. 開発フロー概要

### 2エージェント体制

| エージェント | 役割 | 主な責務 |
|-------------|------|---------|
| **Cursor** | PM（プロジェクトマネージャー） | タスク管理、レビュー、本番デプロイ判断 |
| **Claude Code** | Worker（作業者） | 実装、テスト、CI修正、staging デプロイ |

### ワークフロー

```
Cursor (PM)          Claude Code (Worker)
    │                       │
    │  1. タスク依頼        │
    │  (/handoff-to-claude)      │
    │──────────────────────>│
    │                       │
    │                       │ 2. 状況把握→実装→コミット
    │                       │    (/sync-status → /work)
    │                       │
    │  3. 完了報告          │
    │  (/handoff-to-cursor) │
    │<──────────────────────│
    │                       │
    │ 4. レビュー・本番判断  │
    │  (/review-cc-work)    │
    │                       │
```

---

## 1. ファイル構成

| ファイル | 用途 | 参照者 |
|---------|------|--------|
| `AGENTS.md` | 開発フロー概要（このファイル） | 両方 |
| `CLAUDE.md` | Claude Code 固有設定 | Claude Code |
| `Plans.md` | タスク管理 | 両方 |

---

## 2. 役割分担

### Cursor（PM）の責務

- [ ] タスクの定義と Plans.md への追加
- [ ] Claude Code への作業依頼
- [ ] 完了報告のレビュー
- [ ] 本番デプロイの判断と実行

### Claude Code（Worker）の責務

- [ ] タスクの実装
- [ ] テストの実行
- [ ] コミット & プッシュ
- [ ] CI 失敗時の修正（3回まで）
- [ ] staging デプロイ（該当する場合）
- [ ] 完了報告の作成

---

## 3. タスク管理（Plans.md）

### マーカー一覧

| マーカー | 意味 | 設定者 |
|---------|------|--------|
| `pm:依頼中` | PM から依頼（互換: cursor:依頼中） | PM（Cursor/PM Claude） |
| `cc:TODO` | Claude Code 未着手 | どちらでも |
| `cc:WIP` | Claude Code 作業中 | Claude Code |
| `cc:完了` | Claude Code 完了 | Claude Code |
| `pm:確認済` | PM 確認完了（互換: cursor:確認済） | PM（Cursor/PM Claude） |
| `cursor:依頼中` | （互換）pm:依頼中 と同義 | Cursor |
| `cursor:確認済` | （互換）pm:確認済 と同義 | Cursor |
| `blocked` | ブロック中 | どちらでも |

### 状態遷移

```
pm:依頼中 → cc:WIP → cc:完了 → pm:確認済
```

---

## 4. CI/CD ルール

### Claude Code の対応範囲

- ✅ CI エラーの自動修正（3回まで）
- ✅ staging 環境へのデプロイ
- ❌ 本番デプロイは禁止（Cursor の責務）

### 3回ルール

CI が 3回連続で失敗した場合：
1. 自動修正を中止
2. エスカレーションレポートを作成
3. Cursor に判断を委ねる

---

## 5. コミットメッセージ規約

```
feat: 新機能
fix: バグ修正
docs: ドキュメント
refactor: リファクタリング
test: テスト
chore: その他
```

例: `feat: ユーザー認証機能を追加`

---

## 6. 禁止事項

### Claude Code の禁止事項

- ❌ 本番環境への直接デプロイ
- ❌ 4回以上の CI 自動修正
- ❌ スコープ外の作業（依頼されていない機能追加など）
- ❌ セキュリティに関わる設定変更（API キー、認証など）

### 共通の禁止事項

- ❌ main ブランチへの直接プッシュ
- ❌ force push
- ❌ 機密情報のコミット

---

## 7. トラブルシューティング

### よくある問題

| 症状 | 対処法 |
|------|--------|
| CI が失敗し続ける | 3回試行後、Cursor にエスカレーション |
| タスクが不明確 | Cursor に確認を依頼 |
| Plans.md が更新されていない | `/sync-status` で状態確認 |

---

*このドキュメントは Cursor と Claude Code の両方が参照します。*
