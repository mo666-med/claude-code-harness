# /start-session - セッション開始（統合フロー）

Cursor (PM) としてのセッションを開始します。
状況確認 → ヒアリング → 計画立案 → Claude Code への依頼まで、**シームレスに進行**します。

**Named Sessions 対応**: セッション名を自動生成し、後から `/resume <name>` で再開可能です。

---

## 使い方

```
/start-session
```

または自然言語で：
- 「今日の作業を始めたい」
- 「状況を確認して」
- 「何から始めればいい？」

---

## 実行フロー（自動進行）

このコマンドは以下のステップを**自動的に連続実行**します。
ユーザーの入力が必要な箇所でのみ一時停止します。

```
┌─────────────────────────────────────────────────────┐
│  /start-session                                     │
│                                                     │
│  Step 0: セッション名を生成（自動）                  │
│    ↓                                                │
│  Step 1: 状況確認（自動）                            │
│    ↓                                                │
│  Step 2: ヒアリング「今日は何をしますか？」           │
│    ↓ ユーザー入力                                   │
│  Step 3: 計画立案（自動）                            │
│    ↓                                                │
│  Step 4: 確認「この計画でOK？」                      │
│    ↓ ユーザー「OK」                                 │
│  Step 5: Claude Code に依頼（自動）                  │
│    ↓                                                │
│  完了：Plans.md 更新 + セッション記録 + 依頼生成     │
└─────────────────────────────────────────────────────┘
```

---

## Step 0: セッション名の生成（自動実行）

セッション名を自動生成します。後から `/resume <name>` で再開可能になります。

**命名規則**: `{project}-{feature}-{YYYYMMDD}`

```bash
# プロジェクト名を取得
PROJECT_NAME=$(basename $(pwd))

# 日付を取得
DATE=$(date +%Y%m%d)

# セッション名を生成（feature はユーザー入力後に確定）
SESSION_NAME="${PROJECT_NAME}-session-${DATE}"
```

**出力例:**
```
🏷️ **セッション名**: myapp-session-20250111

💡 ヒント: タスク確定後、より具体的な名前に変更できます
   `/rename myapp-darkmode-20250111`
```

---

## Step 1: 状況確認（自動実行）

```bash
# Plans.md から現在のタスク状況を確認
cat Plans.md

# 最近の git 履歴を確認
git log --oneline -5

# 未コミットの変更を確認
git status -sb
```

**出力例:**
```
📊 **現在の状況** - 2025-01-15 09:00

- 🔴 進行中: 0件
- 🟡 未着手: 2件
- 🟢 確認待ち: 1件

最近: feat: ログイン画面の実装 (昨日)
```

---

## Step 2: ヒアリング（ユーザー入力待ち）

状況に応じた質問を表示：

### パターン A: 確認待ちタスクがある場合

```
🔔 **確認待ちのタスクがあります**

- 「ユーザー認証機能の実装」が完了報告されています

**どうしますか？**
1. レビューする → 「レビュー」
2. 後回しにして新しいタスク → やりたいことを教えてください
```

### パターン B: 進行中タスクがある場合

```
🔄 **進行中のタスクがあります**

- 「商品一覧ページの実装」が作業中

**どうしますか？**
1. 続きを進める → 「続き」
2. 別のタスクを始める → やりたいことを教えてください
```

### パターン C: 新規 or 未着手のみ

```
🎯 **今日は何をしますか？**

例：
- 「ダークモードを追加したい」
- 「バグを直したい」
- 「〇〇機能を作りたい」

ざっくりで大丈夫です！
```

**→ ユーザーの回答を待つ**

---

## Step 3: 計画立案（自動実行）

ユーザーの回答に基づいて、**自動的に**計画を立案します。
（内部で `/plan-with-cc` 相当の処理を実行）

```markdown
📋 **計画を立てました**

「{{ユーザーの要望}}」を実現するために：

### タスク一覧
1. [ ] {{タスク1}} - {{概要}}
2. [ ] {{タスク2}} - {{概要}}
3. [ ] {{タスク3}} - {{概要}}

---

この計画で進めますか？

- 「OK」または「進めて」→ Claude Code に依頼
- 「修正して」→ 計画を調整
- 「もっと詳しく」→ 各タスクを詳細化
```

**→ ユーザーの確認を待つ**

---

## Step 4: 確認後の自動依頼

ユーザーが「OK」「進めて」「いいよ」などと回答したら：

### 4-1: Plans.md を自動更新

```markdown
## 最終更新情報

- **更新日時**: {{YYYY-MM-DD HH:MM}}
- **セッション名**: {{SESSION_NAME}}
- **再開方法**: `/resume {{SESSION_NAME}}`

---

## 🟡 未着手のタスク

- [ ] タスク1 `cursor:依頼中`
  - 概要: {{概要}}
  - 完了条件: {{条件}}

- [ ] タスク2 `cursor:依頼中`
  ...
```

### 4-2: Claude Code への依頼メッセージを生成

```markdown
---

## ✅ セッション開始完了

Plans.md を更新しました。

🏷️ **セッション名**: {{SESSION_NAME}}
📝 **再開方法**: Claude Code で `/resume {{SESSION_NAME}}`

---

## 📋 Claude Code への依頼

以下のタスクを Claude Code に依頼します：

**タスク**: {{タスク名}}
**セッション**: {{SESSION_NAME}}
**依頼日時**: {{YYYY-MM-DD HH:MM}}

### 完了条件
- [ ] {{条件1}}
- [ ] {{条件2}}

---

**Claude Code で以下を実行してください：**

1. このプロジェクトを開く
2. 「タスクを始めて」または `/start-task` と入力

💡 Claude Code にこのメッセージをコピペするか、Plans.md を見せてください
```

---

## シームレス化のポイント

### 1. 自動進行

ユーザーが入力するのは：
- 「今日やりたいこと」（1回）
- 「OK」（1回）

の**最大2回のみ**。残りは自動実行。

### 2. 状況に応じた分岐

| 状況 | 自動アクション |
|------|---------------|
| 確認待ちあり | レビューを促す |
| 進行中あり | 続行 or 新規を確認 |
| 新規/未着手のみ | ヒアリング開始 |

### 3. 中断可能

どのステップでも：
- 「やっぱりやめる」→ 終了
- 「後で」→ 状態を保持して終了

---

## 出力例（フル会話）

```
ユーザー: /start-session

Cursor:
📊 **現在の状況** - 2025-01-15 09:00
- 🔴 進行中: 0件
- 🟡 未着手: 0件
- 🟢 確認待ち: 0件

🎯 **今日は何をしますか？**

ユーザー: ダークモードを追加したい

Cursor:
📋 **計画を立てました**

「ダークモードを追加」を実現するために：

1. [ ] テーマ切り替えの状態管理を実装
2. [ ] ダークモード用カラーパレットを定義
3. [ ] 全コンポーネントにテーマを適用
4. [ ] 切り替えボタンをヘッダーに追加

この計画で進めますか？

ユーザー: OK

Cursor:
✅ **Plans.md を更新しました**

📋 **Claude Code への依頼**

タスク: ダークモード機能の追加
- テーマ切り替えの状態管理を実装
- ダークモード用カラーパレットを定義
- 全コンポーネントにテーマを適用
- 切り替えボタンをヘッダーに追加

**Claude Code で「タスクを始めて」と言ってください**
```

---

## 関連コマンド

通常は `/start-session` だけで完結しますが、個別に使うことも可能：

| コマンド | 用途 |
|---------|------|
| `/project-overview` | 詳細な状況確認のみ |
| `/plan-with-cc` | 計画立案のみ |
| `/assign-to-cc` | タスク依頼のみ |
| `/review-cc-work` | レビューのみ |
