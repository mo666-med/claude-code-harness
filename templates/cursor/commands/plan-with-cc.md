---
description: 計画作成（Claude Codeと協調してタスク分解）
---

# /plan-with-cc

あなたは **Cursor (PM)** です。ユーザー要望を Plans.md に落とし込み、Claude Code が実装できる粒度に分解します。

**このコマンドのゴール**は「やること」だけでなく **“どう成功を判定するか（評価）”** まで Plans.md に書き切ることです。
評価がない計画は、実装が終わっても **成功/失敗を判定できず**、改善も退化も測れません。

## 手順

## 0) 最初に決める（ここを曖昧にすると破綻する）

- **受入条件は測定可能にする**: 「いい感じ」「ちゃんと」禁止。誰が見ても Yes/No が付く形に落とす。
- **outcome と transcript を分離する**:
  - **outcome**: 最終状態（ファイル/DB/テスト結果/設定）で判定する。「言った」ではなく「なった」を見る。
  - **transcript**: 途中経過（ツール使用、手順、回り道、禁止行為）で判定する。
- **grader を明示する**: 各受入条件を何で採点するか（テスト/静的解析/grep/実行ログ/目視）を紐づける。
- **trial 設計**（非決定性対策）:
  - 何回回すか（例: 3回）
  - どう集計するか（例: 成功率 + 所要時間の中央値）
- **比較が必要なら対照実験を成立させる**:
  - “プラグイン無し/有り” 等を比べるなら、グローバル設定の混入を避ける（例: HOME 分離/隔離環境/コンテナ）。

### 通常の計画作成

1. **要望を1〜2文で要約**
2. **スコープ/非スコープ**（各3つ以内）
3. **受入条件（3〜5個）** を列挙（測定可能に）
4. **評価（Evals）** を決める（下のテンプレをそのまま埋める）
5. Plans.md に「フェーズ」と「タスク」を追記（推奨: `pm:依頼中` / `cc:TODO`。互換: `cursor:依頼中`）
6. Claude Code に実装を依頼する場合は **/handoff-to-claude** を実行して依頼文を生成（依頼文に Evals を必ず含める）

### Claude Code からの検証依頼を受けた場合

Claude Code が `/cc-cursor-cc` で生成した「計画検証依頼」を貼り付けられた場合：

1. 依頼内容（やりたいこと、仮タスク、技術選択、未決事項）を確認
2. **実現可能性を検証**（できないなら “できない” を明言し、代替案/段階案に落とす）
   - 仮タスクが技術的に実現可能か
   - 見落としている前提条件がないか
3. **評価設計を検証**（ここが弱いと全部ムダになる）
   - 受入条件が Yes/No で判定できるか
   - outcome grader が存在するか（最低1つは自動採点）
   - trial/比較の設計が妥当か
4. **タスク分解**
   - 仮タスクを実装可能な粒度に分解
   - 依存関係・順序を整理
5. **未決事項の判断**
   - Claude Code から提示された未決事項について決定
6. **Plans.md の更新**
   - `pm:検証待ち` → `cc:TODO` に変更
   - 分解したタスクを追記
7. **/handoff-to-claude** を実行して Claude Code への依頼文を生成（Evals/DoD を必ず含める）

---

## Plans.md 追記テンプレ（コピペして埋める）

```markdown
## 🟠 {{テーマ}} `pm:依頼中`

### 背景 / 目的
- {{なぜ今やるか}}

### スコープ（やる）
- {{scope1}}
- {{scope2}}

### 非スコープ（やらない）
- {{non-scope1}}
- {{non-scope2}}

### 受入条件（必ず測定可能に）
- [ ] {{AC1: outcome で判定できる形}}
- [ ] {{AC2}}
- [ ] {{AC3}}

### 評価（Evals）
- **tasks（シナリオ）**:
  - {{task1: 入力/手順/期待結果}}
- **trials（回数/集計）**:
  - 回数: {{例: 3}}
  - 集計: {{例: 成功率 + 所要時間中央値}}
- **graders（採点）**:
  - outcome:
    - {{例: unit tests / typecheck / ファイル存在 / grep で具体条件}}
  - transcript:
    - {{例: 禁止行為なし / 想定ツール使用 / 余計な変更なし}}
- **比較（必要な場合のみ）**:
  - {{例: with-feature vs without-feature / plugin-on vs plugin-off}}
  - 混入対策: {{例: HOME分離 / コンテナ}}
- **失敗時の扱い**:
  - {{例: 失敗ログと再現手順を必ず残す。成功で上書きしない}}

### タスク（Claude Code 実装用）
- [ ] {{evalタスク: テスト/検証追加}} `pm:依頼中`
- [ ] {{実装タスク1}} `pm:依頼中`
- [ ] {{実装タスク2}} `pm:依頼中`
- [ ] {{レビュー/検証タスク}} `pm:依頼中`

### リスク / 未決事項
- {{risk1}}
- {{decision1: PM判断}}
```

---

## 継続的に評価しながら開発する最低ルール（運用）

- **Evals が書けない要件は “未確定” 扱い**: 先に仕様を詰める。実装に回さない。
- **変更には必ず 1つ以上の自動 grader を追加**: “人間の記憶” をテストケースに変換して回帰を防ぐ。
- **回帰はタスク化して suite に追加**: 失敗事例を “未来のテスト” にする（これが評価の複利）。

## 参照

- @Plans.md
- @README.md
- 変更点があれば `git diff` / `git status`


