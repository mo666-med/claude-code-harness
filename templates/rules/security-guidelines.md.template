# セキュリティガイドライン

> このルールは Claude harness によって自動生成されました。
> 目的: セキュリティ上の注意が必要な変更を検出し、チェックリストを提示します。

## セキュリティ注意が必要なパターン

### ファイルパス判定

| パスパターン | 注意レベル | 理由 |
|-------------|-----------|------|
| `src/auth/`, `auth/` | 🔴 高 | 認証ロジック |
| `src/api/`, `api/`, `routes/` | 🟠 中 | API エンドポイント |
| `middleware/` | 🟠 中 | リクエスト処理 |
| `src/payment/`, `billing/` | 🔴 高 | 決済処理 |
| `config/`, `.env*` | 🟠 中 | 機密設定 |

### コード変更パターン

| パターン | 注意レベル | 理由 |
|---------|-----------|------|
| `password`, `secret`, `token` | 🔴 高 | 認証情報 |
| 動的コード評価関数 | 🔴 高 | 任意コード実行リスク |
| SQL クエリの文字列連結 | 🔴 高 | SQL インジェクション |
| React の生 HTML 挿入 | 🟠 中 | XSS リスク |
| `cors()` 設定変更 | 🟠 中 | クロスオリジン |

## OWASP Top 10 対応チェックリスト

### 認証・認可変更時

- [ ] **A01: アクセス制御の欠陥**
  - 認可チェックが全エンドポイントにあるか
  - ロールベースアクセス制御が正しいか

- [ ] **A02: 暗号化の失敗**
  - パスワードはハッシュ化されているか（bcrypt, argon2）
  - 機密データは暗号化されているか
  - HTTPS が強制されているか

- [ ] **A07: 認証の失敗**
  - ブルートフォース対策（レート制限）
  - セッション管理が適切か
  - MFA 対応を検討したか

### API 変更時

- [ ] **A03: インジェクション**
  - 入力値がサニタイズされているか
  - パラメータ化クエリを使用しているか
  - コマンドインジェクション対策

- [ ] **A04: 安全でない設計**
  - 最小権限の原則
  - 入力検証がビジネスロジックレベルで実装されているか

- [ ] **A05: セキュリティの設定ミス**
  - 不要なエンドポイントが公開されていないか
  - エラーメッセージが詳細すぎないか
  - デフォルト認証情報が変更されているか

### 依存関係変更時

- [ ] **A06: 脆弱で古いコンポーネント**
  - 追加するパッケージに既知の脆弱性がないか（`npm audit`）
  - バージョンが最新か
  - メンテナンスされているか

## スキル向け判定ロジック

```
ファイル変更検出
    ↓
パスパターンマッチ
    ↓
├── auth/, api/, payment/ → セキュリティチェックリスト表示
├── middleware/ → CORS, 認可チェック
├── .env*, config/ → 機密情報露出チェック
└── その他 → 通常処理
```

## 提案テンプレート

**認証関連変更時**:
> ⚠️ 認証関連のコード変更を検出しました。
> セキュリティチェックリストを確認してください：
> - [ ] パスワードハッシュ化
> - [ ] セッション管理
> - [ ] レート制限

**API 変更時**:
> ⚠️ API エンドポイントの変更を検出しました。
> - [ ] 入力値バリデーション
> - [ ] 認可チェック
> - [ ] エラーハンドリング

## VibeCoder 向け（言い換え）

| 技術用語 | VibeCoder 向け |
|---------|---------------|
| 認証 | ログイン・パスワード関連 |
| 認可 | 誰が何をできるかの制御 |
| サニタイズ | 危険な文字を無害化 |
| インジェクション | 悪意あるコードの注入 |

**VibeCoder 向け提案**:
> 🔐 ログインに関わる変更です。
> セキュリティの専門家にレビューしてもらうことを推奨します。
> 最低限、以下を確認してください：
> - パスワードが平文で保存されていないか
> - ログイン試行回数の制限があるか

## 注意事項

- **警告は提案**: 最終判断はユーザー
- **false positive を許容**: 安全側に倒す
- **専門家レビュー推奨**: 重要な変更は人間のレビューを推奨
