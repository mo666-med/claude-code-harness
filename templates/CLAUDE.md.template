# CLAUDE.md - Claude Code 実行指示書

> **プロジェクト**: {{PROJECT_NAME}}
> **作成日**: {{DATE}}
> **言語**: {{LANGUAGE}}

---

## ⚠️ 最初に読むこと

**`AGENTS.md` を必ず最初に参照してください。**

- 開発フロー概要
- 役割分担
- 禁止事項

本ファイルは **Claude Code 固有の設定** のみを記載しています。

---

## 1. Claude Code の責務範囲

### ✅ 担当する作業

- 4ファイル以上・100行超の実装
- コミット & プッシュ
- CI 通過確認（失敗時は自動修正、3回まで）
- staging デプロイ（該当する場合）

### ❌ 禁止事項

- **本番デプロイは禁止**（Cursor の責務）
- スコープ外の作業
- セキュリティ設定の変更

---

## 2. コミットメッセージ規約

```
feat: 新機能
fix: バグ修正
docs: ドキュメント
refactor: リファクタリング
test: テスト
chore: その他
```

例: `feat: ユーザー認証機能を追加`

---

## 3. CI 失敗時の対応

### 対応フロー

1. CI 失敗を検知
2. エラーログを確認
3. 修正 → 再コミット → CI 再実行
4. **3回失敗した場合は Cursor にエスカレーション**

### エスカレーション報告フォーマット

```markdown
## ⚠️ CI失敗エスカレーション

**失敗回数**: 3回
**ブランチ**: {{branch}}

### エラー内容
[エラーログの要約]

### 試した修正
1. [修正1]
2. [修正2]
3. [修正3]

### 推定原因
[原因の推測]

### Cursor への依頼
[具体的な依頼内容]
```

---

## 4. ハンドオフプロトコル

### Cursor → Claude Code（作業依頼）

```markdown
## 作業依頼
- **タスク概要**: 具体的な作業内容
- **スコープ**: 変更対象ファイル・範囲
- **完了条件**: 明確な受け入れ基準
```

### Claude Code → Cursor（作業完了報告）

`/handoff-to-cursor` コマンドを使用するか、以下のフォーマットで報告：

```markdown
## 🎯 作業完了報告

**報告日時**: YYYY-MM-DD HH:MM
**担当**: Claude Code

### 完了タスク
- **タスク名**: [タスクの説明]

### 実施内容
1. [実施した作業1]
2. [実施した作業2]

### 変更ファイル
| ファイル | 変更内容 |
|---------|---------|
| `path/to/file1` | [変更概要] |

### CI 状況
- CI: ✅ 通過 / ❌ 失敗

### 次のアクション（Cursor 向け）
1. [ ] 変更内容の確認
2. [ ] 本番デプロイの判断
```

---

## 5. セッションルーティン

### セッション開始時

```bash
# 状態確認
git status -sb
cat Plans.md
head -50 AGENTS.md
```

または「セッション開始」と入力してスキルを起動。

### 作業完了時

```bash
# コミット（規約に従う）
git add -A
git commit -m "feat: [変更内容]"
git push

# 完了報告
/handoff-to-cursor
```

---

## 6. 利用可能なコマンド

| コマンド | 用途 |
|---------|------|
| `/sync-status` | 状況把握・次アクション提案 |
| `/work` | タスク実行（着手時に cc:WIP に自動更新） |
| `/handoff-to-cursor` | 完了報告 |

---

## 7. トラブルシューティング

| 症状 | 解決策 |
|------|--------|
| タスクが見つからない | Plans.md を確認、または Cursor に依頼 |
| CI が失敗し続ける | 3回まで修正、その後エスカレーション |
| スコープが不明確 | Cursor に確認を依頼 |

---

*このドキュメントは AGENTS.md と連携して使用してください。*
