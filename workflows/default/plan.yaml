# /plan ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©
# æ©Ÿèƒ½è¦æœ›ã‚’æ§‹é€ åŒ–ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã«å¤‰æ›

phase: plan
description: "Plans.md ã‚’æ›´æ–°ã—ã€ã‚¿ã‚¹ã‚¯ã‚’åˆ†è§£ã™ã‚‹ãƒ•ã‚§ãƒ¼ã‚º"

steps:
  # Step 1: ãƒªãƒã‚¸ãƒˆãƒªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®èª­ã¿å–ã‚Š
  - id: read-context
    skill: core-read-repo-context
    input:
      files:
        - README.md
        - Plans.md
        - package.json
      context_from:
        - repo_tree
        - open_files
    mode: required

  # Step 2: è¦æœ›ã®ãƒ’ã‚¢ãƒªãƒ³ã‚°ï¼ˆå…¥åŠ›ãŒãªã„å ´åˆï¼‰
  - id: gather-requirements
    skill: init-requirements
    condition: "!user_prompt"
    input:
      context_from:
        - user_intent
    output:
      variables:
        - feature_request
    mode: optional

  # Step 3: æ©Ÿèƒ½ã®è¨ˆç”»
  - id: plan-feature
    skill: plan-feature
    input:
      files:
        - Plans.md
      context_from:
        - user_prompt
        - repo_diff
        - tech_stack
      variables:
        - feature_request
    output:
      update_files:
        - Plans.md
      variables:
        - task_count
        - phase_name
    mode: required

  # Step 4: è¨ˆç”»ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  - id: review-plan
    skill: plan-review
    input:
      files:
        - Plans.md
      context_from:
        - previous_step_output
    mode: optional

# æˆåŠŸæ™‚ã®å‡ºåŠ›
on_success:
  message: |
    âœ… è¨ˆç”»ãŒå®Œæˆã—ã¾ã—ãŸï¼

    ğŸ“„ Plans.md ã« {{task_count}} å€‹ã®ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

    æ¬¡ã«ã‚„ã‚‹ã“ã¨ï¼š
    - ã€Œ{{phase_name}}ã‚’å§‹ã‚ã¦ã€â†’ å®Ÿè£…ã‚’é–‹å§‹
    - ã€Œè¨ˆç”»ã‚’è¦‹ã›ã¦ã€â†’ è©³ç´°ã‚’ç¢ºèª
    - ã€Œä¿®æ­£ã—ã¦ã€â†’ è¨ˆç”»ã‚’èª¿æ•´

# ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡ºåŠ›
on_error:
  message: |
    âš ï¸ è¨ˆç”»ä½œæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

    ã‚„ã‚ŠãŸã„ã“ã¨ã‚’ã‚‚ã†ä¸€åº¦æ•™ãˆã¦ãã ã•ã„ã€‚
