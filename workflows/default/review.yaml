# /harness-review ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©ï¼ˆæ—§å: reviewï¼‰
# ä½œæˆã—ãŸã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’ãƒã‚§ãƒƒã‚¯

phase: review
description: "ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’ãƒã‚§ãƒƒã‚¯ã—ã€æ”¹å–„ç‚¹ã‚’ææ¡ˆã™ã‚‹ãƒ•ã‚§ãƒ¼ã‚º"

steps:
  # Step 1: å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ã®ç‰¹å®š
  - id: identify-changes
    skill: core-read-repo-context
    input:
      context_from:
        - git_diff
        - recent_commits
    output:
      variables:
        - changed_files
        - change_summary
    mode: required

  # Step 2: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
  - id: security-check
    skill: review-security
    input:
      files: "{{changed_files}}"
      context_from:
        - code_content
    output:
      variables:
        - security_issues
        - security_score
    mode: required
    parallel: true

  # Step 3: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯
  - id: performance-check
    skill: review-performance
    input:
      files: "{{changed_files}}"
      context_from:
        - code_content
    output:
      variables:
        - performance_issues
        - performance_score
    mode: required
    parallel: true

  # Step 4: ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
  - id: quality-check
    skill: review-quality
    input:
      files: "{{changed_files}}"
      context_from:
        - code_content
        - eslint_output
    output:
      variables:
        - quality_issues
        - quality_score
    mode: required
    parallel: true

  # Step 5: ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ï¼ˆWeb ã®å ´åˆï¼‰
  - id: accessibility-check
    skill: review-accessibility
    condition: "tech_stack.includes('react') || tech_stack.includes('vue')"
    input:
      files: "{{changed_files}}"
    output:
      variables:
        - a11y_issues
        - a11y_score
    mode: optional
    parallel: true

  # Step 6: ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã®é›†ç´„
  - id: aggregate-results
    skill: review-aggregate
    input:
      variables:
        - security_issues
        - performance_issues
        - quality_issues
        - a11y_issues
    output:
      variables:
        - overall_grade
        - improvement_suggestions
    mode: required

  # Step 7: æ”¹å–„ã®é©ç”¨ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªå¾Œï¼‰
  - id: apply-improvements
    skill: review-apply-fixes
    condition: "user_approved"
    input:
      variables:
        - improvement_suggestions
    output:
      update_files: true
    mode: optional

# æˆåŠŸæ™‚ã®å‡ºåŠ›
on_success:
  message: |
    ğŸ“Š ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ

    **ç·åˆè©•ä¾¡**: {{overall_grade}}

    | è¦³ç‚¹ | è©•ä¾¡ |
    |------|------|
    | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | {{security_score}} |
    | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ | {{performance_score}} |
    | ã‚³ãƒ¼ãƒ‰å“è³ª | {{quality_score}} |

    {{improvement_suggestions}}

    è‡ªå‹•ã§ä¿®æ­£ã—ã¾ã™ã‹ï¼Ÿ

# ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡ºåŠ›
on_error:
  message: |
    âš ï¸ ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

    æ‰‹å‹•ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚
