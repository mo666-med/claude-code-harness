# Reference Solution: VP-03 (バグ修正の曖昧な依頼)

## 元のプロンプト

「なんかエラーが出るから直して。前は動いてたのに急に動かなくなった。多分データの変換のとこがおかしい」

## 曖昧さの問題点

1. **エラー内容が不明**: 「なんか」では原因特定不可
2. **再現条件が不明**: いつ、どうすると発生するか
3. **「多分」で原因推測が曖昧**: 本当にデータ変換が原因か不明
4. **どの「データの変換」か不明**: 複数ある場合に特定不可

## 参照解（理想的な Plans.md）

```markdown
# Plans.md - バグ修正計画

## 要件確認（ユーザーへのヒアリング結果）

### 情報収集

| 項目 | ユーザーへの質問 | 回答・決定 |
|------|-----------------|-----------|
| エラー内容 | 「どんなエラーメッセージが出る？」 | 「Cannot read property of undefined」 |
| 再現条件 | 「どうすると発生する？」 | 「計算ボタンを押すと発生」 |
| 発生タイミング | 「いつから発生？」 | 「昨日の変更後から」 |
| 該当箇所 | 「どの画面？」 | 「計算機能の画面」 |

---

## フェーズ1: 原因調査 `cc:TODO`

### 調査手順

1. エラーログの確認
2. 最近の変更履歴（git log）の確認
3. 問題箇所の特定（src/utils.ts の calculate 関数が疑わしい）

### 仮説

- ゼロ除算が発生している可能性
- null/undefined のチェックが不足

---

## フェーズ2: 再現テスト作成 `cc:TODO` `[feature:tdd]`

### テストケース設計

| テストケース | 入力 | 期待出力 | 備考 |
|-------------|------|---------|------|
| 正常系 | `(10, 2)` | `5` | 通常の除算 |
| ゼロ除算 | `(10, 0)` | エラー or 0 | **バグの再現** |
| 負数 | `(-10, 2)` | `-5` | エッジケース |
| 小数 | `(10, 3)` | `3.33...` | 精度確認 |

---

## フェーズ3: バグ修正 `cc:TODO`

### 修正内容

```typescript
// Before
export function calculate(a: number, b: number): number {
  return a / b;  // バグ: ゼロ除算チェックなし
}

// After
export function calculate(a: number, b: number): number {
  if (b === 0) {
    throw new Error('Division by zero is not allowed');
  }
  return a / b;
}
```

---

## フェーズ4: 回帰テスト `cc:TODO`

- [ ] 新規テストが通ることを確認
- [ ] 既存テストが壊れていないことを確認
- [ ] 手動で再現テスト

---

## フェーズ5: 根本原因の記録 `cc:TODO`

### 根本原因分析

- **直接原因**: ゼロ除算のガードがなかった
- **根本原因**: 入力バリデーションが不十分
- **再発防止**: バリデーション層の追加を検討
```

## 評価ポイント

### 必須要素

1. ✅ エラー内容の確認・特定
2. ✅ 再現条件の明確化
3. ✅ 再現テストの作成
4. ✅ 根本原因の分析
5. ✅ `[feature:tdd]` マーカー
6. ✅ 回帰テストの計画
